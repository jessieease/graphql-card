{"ast":null,"code":"\"use strict\";\n\nvar __extends = void 0 && (void 0).__extends || function () {\n  var _extendStatics = function extendStatics(d, b) {\n    _extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) {\n        if (b.hasOwnProperty(p)) d[p] = b[p];\n      }\n    };\n\n    return _extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    _extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __assign = void 0 && (void 0).__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) {\n        if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar _a;\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar immutable_1 = require(\"immutable\");\n\nvar redux_actions_1 = require(\"redux-actions\");\n\nvar actions_1 = require(\"./actions\");\n\nvar selectors_1 = require(\"./selectors\");\n\nvar constants_1 = require(\"../../constants\");\n\nvar cuid = require(\"cuid\");\n\nvar fetchingSagas_1 = require(\"./fetchingSagas\");\n\nvar react_sortable_hoc_1 = require(\"react-sortable-hoc\"); // tslint:disable\n\n\nvar Session =\n/** @class */\nfunction (_super) {\n  __extends(Session, _super);\n\n  function Session() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  Session.prototype.toJSON = function () {\n    var obj = this.toObject();\n    var override = {\n      queryRunning: false,\n      subscriptionActive: false,\n      responseExtensions: {}\n    }; // dont serialize very big responses as the localStorage size is limited\n\n    if (obj.responses && obj.responses.size > 0 && (obj.responses.size > 20 || obj.responses.get(0).date.length > 2000)) {\n      override.responses = immutable_1.List();\n    }\n\n    return immutable_1.merge(obj, override);\n  };\n\n  return Session;\n}(immutable_1.Record(constants_1.getDefaultSession('')));\n\nexports.Session = Session;\n\nvar ResponseRecord =\n/** @class */\nfunction (_super) {\n  __extends(ResponseRecord, _super);\n\n  function ResponseRecord() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  return ResponseRecord;\n}(immutable_1.Record({\n  resultID: '',\n  date: '',\n  time: new Date(),\n  isSchemaError: false\n}));\n\nexports.ResponseRecord = ResponseRecord;\n\nfunction makeSession(endpoint) {\n  if (endpoint === void 0) {\n    endpoint = '';\n  }\n\n  return new Session({\n    endpoint: endpoint\n  }).set('id', cuid());\n}\n\nfunction sessionFromTab(tab) {\n  return new Session(__assign(__assign({}, tab), {\n    headers: tab.headers ? JSON.stringify(tab.headers, null, 2) : '',\n    responses: tab.responses && tab.responses.length > 0 ? immutable_1.List(tab.responses.map(function (r) {\n      return new ResponseRecord({\n        date: r\n      });\n    })) : immutable_1.List()\n  })).set('id', cuid());\n}\n\nexports.sessionFromTab = sessionFromTab;\n\nvar SessionState =\n/** @class */\nfunction (_super) {\n  __extends(SessionState, _super);\n\n  function SessionState() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  return SessionState;\n}(immutable_1.Record({\n  sessions: immutable_1.OrderedMap({}),\n  selectedSessionId: '',\n  sessionCount: 0,\n  headers: ''\n}));\n\nexports.SessionState = SessionState;\n\nfunction makeSessionState(endpoint) {\n  var _a;\n\n  var session = new Session({\n    endpoint: endpoint || ''\n  });\n  return new SessionState({\n    sessions: immutable_1.OrderedMap((_a = {}, _a[session.id] = session, _a)),\n    selectedSessionId: session.id,\n    sessionCount: 1\n  });\n}\n\nexports.makeSessionState = makeSessionState;\nvar reducer = redux_actions_1.handleActions((_a = {}, _a[redux_actions_1.combineActions(actions_1.editQuery, actions_1.editVariables, actions_1.editHeaders, actions_1.editEndpoint, actions_1.setEditorFlex, actions_1.openQueryVariables, actions_1.closeQueryVariables, actions_1.setVariableEditorHeight, actions_1.setResponseTracingHeight, actions_1.setTracingSupported, actions_1.setVariableToType, actions_1.setOperations, actions_1.setOperationName, actions_1.setSubscriptionActive, actions_1.startQuery, actions_1.setQueryTypes, actions_1.editName, actions_1.setResponseExtensions, actions_1.setCurrentQueryStartTime, actions_1.setCurrentQueryEndTime)] = function (state, _a) {\n  var payload = _a.payload;\n  var keys = Object.keys(payload);\n  var keyName = keys.length === 1 ? keys[0] : keys[1];\n  var path = ['sessions', selectors_1.getSelectedSessionId(state), keyName];\n  return state.setIn(path, payload[keyName]);\n}, _a.START_QUERY = function (state) {\n  return state.setIn(['sessions', selectors_1.getSelectedSessionId(state), 'queryRunning'], true).setIn(['sessions', selectors_1.getSelectedSessionId(state), 'responseExtensions'], undefined);\n}, _a.CLOSE_TRACING = function (state, _a) {\n  var responseTracingHeight = _a.payload.responseTracingHeight;\n  return state.mergeDeepIn(['sessions', selectors_1.getSelectedSessionId(state)], immutable_1.Map({\n    responseTracingHeight: responseTracingHeight,\n    responseTracingOpen: false\n  }));\n}, _a.TOGGLE_TRACING = function (state) {\n  var path = ['sessions', selectors_1.getSelectedSessionId(state), 'responseTracingOpen'];\n  return state.setIn(path, !state.getIn(path));\n}, _a.OPEN_TRACING = function (state, _a) {\n  var responseTracingHeight = _a.payload.responseTracingHeight;\n  return state.mergeDeepIn(['sessions', selectors_1.getSelectedSessionId(state)], immutable_1.Map({\n    responseTracingHeight: responseTracingHeight,\n    responseTracingOpen: true\n  }));\n}, _a.CLOSE_VARIABLES = function (state, _a) {\n  var variableEditorHeight = _a.payload.variableEditorHeight;\n  return state.mergeDeepIn(['sessions', selectors_1.getSelectedSessionId(state)], immutable_1.Map({\n    variableEditorHeight: variableEditorHeight,\n    variableEditorOpen: false\n  }));\n}, _a.OPEN_VARIABLES = function (state, _a) {\n  var variableEditorHeight = _a.payload.variableEditorHeight;\n  return state.mergeDeepIn(['sessions', selectors_1.getSelectedSessionId(state)], immutable_1.Map({\n    variableEditorHeight: variableEditorHeight,\n    variableEditorOpen: true\n  }));\n}, _a.TOGGLE_VARIABLES = function (state) {\n  var path = ['sessions', selectors_1.getSelectedSessionId(state), 'variableEditorOpen'];\n  return state.setIn(path, !state.getIn(path));\n}, _a.ADD_RESPONSE = function (state, _a) {\n  var _b = _a.payload,\n      response = _b.response,\n      sessionId = _b.sessionId;\n  return state.updateIn(['sessions', sessionId, 'responses'], function (responses) {\n    return responses.push(response);\n  });\n}, _a.SET_RESPONSE = function (state, _a) {\n  var _b = _a.payload,\n      response = _b.response,\n      sessionId = _b.sessionId;\n  return state.setIn(['sessions', sessionId, 'responses'], immutable_1.List([response]));\n}, _a.CLEAR_RESPONSES = function (state) {\n  return state.setIn(['sessions', selectors_1.getSelectedSessionId(state), 'responses'], immutable_1.List());\n}, _a.FETCH_SCHEMA = function (state) {\n  return state.setIn(['sessions', selectors_1.getSelectedSessionId(state), 'isReloadingSchema'], true);\n}, _a.REFETCH_SCHEMA = function (state) {\n  return state.setIn(['sessions', selectors_1.getSelectedSessionId(state), 'isReloadingSchema'], true);\n}, _a.STOP_QUERY = function (state, _a) {\n  var sessionId = _a.payload.sessionId;\n  return state.mergeIn(['sessions', sessionId], {\n    queryRunning: false,\n    subscriptionActive: false\n  });\n}, _a.SET_SCROLL_TOP = function (state, _a) {\n  var _b = _a.payload,\n      sessionId = _b.sessionId,\n      scrollTop = _b.scrollTop;\n\n  if (state.sessions.get(sessionId)) {\n    return state.setIn(['sessions', sessionId, 'scrollTop'], scrollTop);\n  }\n\n  return state;\n}, _a.SCHEMA_FETCHING_SUCCESS = function (state, _a) {\n  var payload = _a.payload;\n  var newSessions = state.get('sessions').map(function (session) {\n    if (session.endpoint === payload.endpoint) {\n      // if there was an error, clear it away\n      var data = {\n        tracingSupported: payload.tracingSupported,\n        isReloadingSchema: false,\n        endpointUnreachable: false\n      };\n      var response = session.responses ? session.responses.first() : null;\n\n      if (response && session.responses.size === 1 && // @ts-ignore\n      response.isSchemaError) {\n        data.responses = immutable_1.List([]);\n      }\n\n      return session.merge(immutable_1.Map(data));\n    }\n\n    return session;\n  });\n  return state.set('sessions', newSessions);\n}, _a.SET_ENDPOINT_UNREACHABLE = function (state, _a) {\n  var payload = _a.payload;\n  var newSessions = state.get('sessions').map(function (session, sessionId) {\n    if (session.get('endpoint') === payload.endpoint) {\n      return session.merge(immutable_1.Map({\n        endpointUnreachable: true\n      }));\n    }\n\n    return session;\n  });\n  return state.set('sessions', newSessions);\n}, _a.SCHEMA_FETCHING_ERROR = function (state, _a) {\n  var payload = _a.payload;\n  var newSessions = state.get('sessions').map(function (session, sessionId) {\n    if (session.get('endpoint') === payload.endpoint) {\n      var responses = session.responses; // Only override the responses if there is one or zero and that one is a schemaError\n      // Don't override user's responses!\n\n      if (responses.size <= 1) {\n        var response = session.responses ? session.responses.first() : null;\n\n        if (!response || response.isSchemaError) {\n          response = new ResponseRecord({\n            resultID: cuid(),\n            isSchemaError: true,\n            date: JSON.stringify(fetchingSagas_1.formatError(payload.error, true), null, 2),\n            time: new Date()\n          });\n        }\n\n        responses = immutable_1.List([response]);\n      }\n\n      return session.merge(immutable_1.Map({\n        isReloadingSchema: false,\n        endpointUnreachable: true,\n        responses: responses\n      }));\n    }\n\n    return session;\n  });\n  return state.set('sessions', newSessions);\n}, _a.SET_SELECTED_SESSION_ID = function (state, _a) {\n  var sessionId = _a.payload.sessionId;\n  return state.set('selectedSessionId', sessionId);\n}, _a.OPEN_SETTINGS_TAB = function (state) {\n  var newState = state;\n  var settingsTab = state.sessions.find(function (value) {\n    return value.get('isSettingsTab', false);\n  });\n\n  if (!settingsTab) {\n    settingsTab = makeSession().merge({\n      isSettingsTab: true,\n      isFile: true,\n      name: 'Settings',\n      changed: false\n    });\n    newState = newState.setIn(['sessions', settingsTab.id], settingsTab);\n  }\n\n  return newState.set('selectedSessionId', settingsTab.id);\n}, _a.OPEN_CONFIG_TAB = function (state) {\n  var newState = state;\n  var configTab = state.sessions.find(function (value) {\n    return value.get('isConfigTab', false);\n  });\n\n  if (!configTab) {\n    configTab = makeSession().merge({\n      isConfigTab: true,\n      isFile: true,\n      name: 'GraphQL Config',\n      changed: false\n    });\n    newState = newState.setIn(['sessions', configTab.id], configTab);\n  }\n\n  return newState.set('selectedSessionId', configTab.id);\n}, _a.NEW_FILE_TAB = function (state, _a) {\n  var _b = _a.payload,\n      fileName = _b.fileName,\n      filePath = _b.filePath,\n      file = _b.file;\n  var newState = state;\n  var fileTab = state.sessions.find(function (value) {\n    return value.get('name', '') === fileName;\n  });\n\n  if (!fileTab) {\n    fileTab = makeSession().merge({\n      isFile: true,\n      name: fileName,\n      changed: false,\n      file: file,\n      filePath: filePath\n    });\n    newState = newState.setIn(['sessions', fileTab.id], fileTab);\n  }\n\n  return newState.set('selectedSessionId', fileTab.id).set('sessionCount', newState.sessions.size);\n}, _a.NEW_SESSION = function (state, _a) {\n  var _b = _a.payload,\n      reuseHeaders = _b.reuseHeaders,\n      endpoint = _b.endpoint;\n  var currentSession = state.sessions.first();\n  var newSession = {\n    query: '',\n    isReloadingSchema: currentSession.isReloadingSchema,\n    endpointUnreachable: currentSession.endpointUnreachable\n  };\n\n  if (currentSession.endpointUnreachable) {\n    newSession.responses = currentSession.responses;\n  }\n\n  var session = makeSession(endpoint || currentSession.endpoint).merge(newSession);\n\n  if (reuseHeaders) {\n    var selectedSessionId = selectors_1.getSelectedSessionId(state);\n    var currentSession_1 = state.sessions.get(selectedSessionId);\n    session = session.set('headers', currentSession_1.headers);\n  } else {\n    session = session.set('headers', state.headers);\n  }\n\n  return state.setIn(['sessions', session.id], session).set('selectedSessionId', session.id).set('sessionCount', state.sessions.size + 1);\n}, // inject headers is used for graphql config\n// it makes sure, that there definitely is a tab open with the correct header\n_a.INJECT_HEADERS = function (state, _a) {\n  var _b = _a.payload,\n      headers = _b.headers,\n      endpoint = _b.endpoint; // if there are no headers to inject, there's nothing to do\n\n  if (!headers || headers === '' || Object.keys(headers).length === 0) {\n    return state;\n  }\n\n  var headersString = typeof headers === 'string' ? headers : JSON.stringify(headers, null, 2);\n  var selectedSessionId = selectors_1.getSelectedSessionId(state);\n  var newState = state.set('headers', headersString);\n  var currentSession = state.sessions.get(selectedSessionId);\n\n  if (currentSession.headers === headersString) {\n    return newState;\n  }\n\n  if (currentSession.query === constants_1.defaultQuery) {\n    return newState.setIn(['sessions', selectedSessionId, 'headers'], headersString);\n  }\n\n  var session = makeSession(endpoint).set('headers', headersString);\n  return newState.setIn(['sessions', session.id], session).set('selectedSessionId', session.id).set('sessionCount', state.sessions.size + 1);\n}, _a.DUPLICATE_SESSION = function (state, _a) {\n  var session = _a.payload.session;\n  var newSession = session.set('id', cuid());\n  return state.setIn(['sessions', newSession.id], newSession).set('selectedSessionId', newSession.id).set('sessionCount', state.sessions.size + 1);\n}, _a.NEW_SESSION_FROM_QUERY = function (state, _a) {\n  var query = _a.payload.query;\n  var session = makeSession().set('query', query);\n  return state.setIn(['sessions', session.id], session).set('sessionCount', state.sessions.size + 1);\n}, _a.CLOSE_SELECTED_TAB = function (state) {\n  var selectedSessionId = selectors_1.getSelectedSessionId(state);\n  return closeTab(state, selectedSessionId).set('sessionCount', state.sessions.size - 1);\n}, _a.SELECT_NEXT_TAB = function (state) {\n  var selectedSessionId = selectors_1.getSelectedSessionId(state);\n  var count = state.sessions.size;\n  var keys = state.sessions.keySeq();\n  var index = keys.indexOf(selectedSessionId);\n\n  if (index + 1 < count) {\n    return state.set('selectedSessionId', keys.get(index + 1));\n  }\n\n  return state.set('selectedSessionId', keys.get(0));\n}, _a.SELECT_PREV_TAB = function (state) {\n  var selectedSessionId = selectors_1.getSelectedSessionId(state);\n  var count = state.sessions.size;\n  var keys = state.sessions.keySeq();\n  var index = keys.indexOf(selectedSessionId);\n\n  if (index - 1 >= 0) {\n    return state.set('selectedSessionId', keys.get(index - 1));\n  }\n\n  return state.set('selectedSessionId', keys.get(count - 1));\n}, _a.SELECT_TAB_INDEX = function (state, _a) {\n  var index = _a.payload.index;\n  var keys = state.sessions.keySeq();\n  return state.set('selectedSessionId', keys.get(index));\n}, _a.SELECT_TAB = function (state, _a) {\n  var sessionId = _a.payload.sessionId;\n  return state.set('selectedSessionId', sessionId);\n}, _a.CLOSE_TAB = function (state, _a) {\n  var sessionId = _a.payload.sessionId;\n  return closeTab(state, sessionId).set('sessionCount', state.sessions.size - 1);\n}, _a.REORDER_TABS = function (state, _a) {\n  var _b = _a.payload,\n      src = _b.src,\n      dest = _b.dest;\n  var seq = state.sessions.toIndexedSeq();\n  var indexes = [];\n\n  for (var i = 0; i < seq.size; i++) {\n    indexes.push(i);\n  }\n\n  var newIndexes = react_sortable_hoc_1.arrayMove(indexes, src, dest);\n  var newSessions = immutable_1.OrderedMap();\n\n  for (var i = 0; i < seq.size; i++) {\n    var ndx = newIndexes[i];\n    var val = seq.get(ndx);\n    newSessions = newSessions.set(val.id, val);\n  }\n\n  return state.set('sessions', newSessions);\n}, _a.EDIT_SETTINGS = function (state) {\n  return state.setIn(['sessions', selectors_1.getSelectedSessionId(state), 'changed'], true);\n}, _a.SAVE_SETTINGS = function (state) {\n  return state.setIn(['sessions', selectors_1.getSelectedSessionId(state), 'changed'], false);\n}, _a.EDIT_CONFIG = function (state) {\n  return state.setIn(['sessions', selectors_1.getSelectedSessionId(state), 'changed'], true);\n}, _a.SAVE_CONFIG = function (state) {\n  return state.setIn(['sessions', selectors_1.getSelectedSessionId(state), 'changed'], false);\n}, _a.EDIT_FILE = function (state) {\n  return state.setIn(['sessions', selectors_1.getSelectedSessionId(state), 'changed'], true);\n}, _a.SAVE_FILE = function (state) {\n  return state.setIn(['sessions', selectors_1.getSelectedSessionId(state), 'changed'], false);\n}, _a), makeSessionState('')); // add a self-healing wrapper to clean up broken states\n\nexports[\"default\"] = function (state, action) {\n  var newState = reducer(state, action);\n\n  if (newState.selectedSessionId === '' && state.sessions.size > 0) {\n    return newState.set('selectedSessionId', state.sessions.first().id);\n  }\n\n  return newState;\n};\n\nfunction closeTab(state, sessionId) {\n  var length = state.sessions.size;\n  var keys = state.sessions.keySeq();\n  var newState = state.removeIn(['sessions', sessionId]);\n  var session = state.sessions.get(sessionId); // if there is only one session, delete it and replace it by a new one\n  // and keep the endpoint & headers of the last one\n\n  if (length === 1) {\n    var newSessionData = {\n      query: '',\n      headers: session.headers,\n      isReloadingSchema: session.isReloadingSchema,\n      endpointUnreachable: session.endpointUnreachable\n    };\n\n    if (session.endpointUnreachable) {\n      newSessionData.responses = session.responses;\n    }\n\n    var newSession = makeSession(session.endpoint).merge(newSessionData);\n    newState = newState.set('selectedSessionId', newSession.id);\n    return newState.setIn(['sessions', newSession.id], newSession);\n  }\n\n  var selectedSessionId = selectors_1.getSelectedSessionId(state);\n  var sessionIndex = keys.indexOf(sessionId); // if the session to be closed is selected, unselect it\n\n  if (selectedSessionId === sessionId) {\n    var leftNeighbour = sessionIndex - 1; // if its the first session on the left, take the right neighbour\n\n    if (leftNeighbour < 0) {\n      return newState.set('selectedSessionId', keys.get(1));\n    }\n\n    return newState.set('selectedSessionId', keys.get(leftNeighbour));\n  } else {\n    // otherwise the old selected session still can be selected, only the session has to be removed\n    return newState;\n  }\n}","map":{"version":3,"sources":["/Users/wubo/Desktop/card-design/card-design/node_modules/graphql-playground-react/lib/state/sessions/reducers.js"],"names":["__extends","_extendStatics","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","__assign","assign","t","s","i","n","arguments","length","call","apply","_a","defineProperty","exports","value","immutable_1","require","redux_actions_1","actions_1","selectors_1","constants_1","cuid","fetchingSagas_1","react_sortable_hoc_1","Session","_super","toJSON","obj","toObject","override","queryRunning","subscriptionActive","responseExtensions","responses","size","get","date","List","merge","Record","getDefaultSession","ResponseRecord","resultID","time","Date","isSchemaError","makeSession","endpoint","set","sessionFromTab","tab","headers","JSON","stringify","map","r","SessionState","sessions","OrderedMap","selectedSessionId","sessionCount","makeSessionState","session","id","reducer","handleActions","combineActions","editQuery","editVariables","editHeaders","editEndpoint","setEditorFlex","openQueryVariables","closeQueryVariables","setVariableEditorHeight","setResponseTracingHeight","setTracingSupported","setVariableToType","setOperations","setOperationName","setSubscriptionActive","startQuery","setQueryTypes","editName","setResponseExtensions","setCurrentQueryStartTime","setCurrentQueryEndTime","state","payload","keys","keyName","path","getSelectedSessionId","setIn","START_QUERY","undefined","CLOSE_TRACING","responseTracingHeight","mergeDeepIn","Map","responseTracingOpen","TOGGLE_TRACING","getIn","OPEN_TRACING","CLOSE_VARIABLES","variableEditorHeight","variableEditorOpen","OPEN_VARIABLES","TOGGLE_VARIABLES","ADD_RESPONSE","_b","response","sessionId","updateIn","push","SET_RESPONSE","CLEAR_RESPONSES","FETCH_SCHEMA","REFETCH_SCHEMA","STOP_QUERY","mergeIn","SET_SCROLL_TOP","scrollTop","SCHEMA_FETCHING_SUCCESS","newSessions","data","tracingSupported","isReloadingSchema","endpointUnreachable","first","SET_ENDPOINT_UNREACHABLE","SCHEMA_FETCHING_ERROR","formatError","error","SET_SELECTED_SESSION_ID","OPEN_SETTINGS_TAB","newState","settingsTab","find","isSettingsTab","isFile","name","changed","OPEN_CONFIG_TAB","configTab","isConfigTab","NEW_FILE_TAB","fileName","filePath","file","fileTab","NEW_SESSION","reuseHeaders","currentSession","newSession","query","currentSession_1","INJECT_HEADERS","headersString","defaultQuery","DUPLICATE_SESSION","NEW_SESSION_FROM_QUERY","CLOSE_SELECTED_TAB","closeTab","SELECT_NEXT_TAB","count","keySeq","index","indexOf","SELECT_PREV_TAB","SELECT_TAB_INDEX","SELECT_TAB","CLOSE_TAB","REORDER_TABS","src","dest","seq","toIndexedSeq","indexes","newIndexes","arrayMove","ndx","val","EDIT_SETTINGS","SAVE_SETTINGS","EDIT_CONFIG","SAVE_CONFIG","EDIT_FILE","SAVE_FILE","action","removeIn","newSessionData","sessionIndex","leftNeighbour"],"mappings":"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","sourcesContent":["\"use strict\";\n\nvar __extends = void 0 && (void 0).__extends || function () {\n  var _extendStatics = function extendStatics(d, b) {\n    _extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) {\n        if (b.hasOwnProperty(p)) d[p] = b[p];\n      }\n    };\n\n    return _extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    _extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __assign = void 0 && (void 0).__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) {\n        if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar _a;\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar immutable_1 = require(\"immutable\");\n\nvar redux_actions_1 = require(\"redux-actions\");\n\nvar actions_1 = require(\"./actions\");\n\nvar selectors_1 = require(\"./selectors\");\n\nvar constants_1 = require(\"../../constants\");\n\nvar cuid = require(\"cuid\");\n\nvar fetchingSagas_1 = require(\"./fetchingSagas\");\n\nvar react_sortable_hoc_1 = require(\"react-sortable-hoc\"); // tslint:disable\n\n\nvar Session =\n/** @class */\nfunction (_super) {\n  __extends(Session, _super);\n\n  function Session() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  Session.prototype.toJSON = function () {\n    var obj = this.toObject();\n    var override = {\n      queryRunning: false,\n      subscriptionActive: false,\n      responseExtensions: {}\n    }; // dont serialize very big responses as the localStorage size is limited\n\n    if (obj.responses && obj.responses.size > 0 && (obj.responses.size > 20 || obj.responses.get(0).date.length > 2000)) {\n      override.responses = immutable_1.List();\n    }\n\n    return immutable_1.merge(obj, override);\n  };\n\n  return Session;\n}(immutable_1.Record(constants_1.getDefaultSession('')));\n\nexports.Session = Session;\n\nvar ResponseRecord =\n/** @class */\nfunction (_super) {\n  __extends(ResponseRecord, _super);\n\n  function ResponseRecord() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  return ResponseRecord;\n}(immutable_1.Record({\n  resultID: '',\n  date: '',\n  time: new Date(),\n  isSchemaError: false\n}));\n\nexports.ResponseRecord = ResponseRecord;\n\nfunction makeSession(endpoint) {\n  if (endpoint === void 0) {\n    endpoint = '';\n  }\n\n  return new Session({\n    endpoint: endpoint\n  }).set('id', cuid());\n}\n\nfunction sessionFromTab(tab) {\n  return new Session(__assign(__assign({}, tab), {\n    headers: tab.headers ? JSON.stringify(tab.headers, null, 2) : '',\n    responses: tab.responses && tab.responses.length > 0 ? immutable_1.List(tab.responses.map(function (r) {\n      return new ResponseRecord({\n        date: r\n      });\n    })) : immutable_1.List()\n  })).set('id', cuid());\n}\n\nexports.sessionFromTab = sessionFromTab;\n\nvar SessionState =\n/** @class */\nfunction (_super) {\n  __extends(SessionState, _super);\n\n  function SessionState() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  return SessionState;\n}(immutable_1.Record({\n  sessions: immutable_1.OrderedMap({}),\n  selectedSessionId: '',\n  sessionCount: 0,\n  headers: ''\n}));\n\nexports.SessionState = SessionState;\n\nfunction makeSessionState(endpoint) {\n  var _a;\n\n  var session = new Session({\n    endpoint: endpoint || ''\n  });\n  return new SessionState({\n    sessions: immutable_1.OrderedMap((_a = {}, _a[session.id] = session, _a)),\n    selectedSessionId: session.id,\n    sessionCount: 1\n  });\n}\n\nexports.makeSessionState = makeSessionState;\nvar reducer = redux_actions_1.handleActions((_a = {}, _a[redux_actions_1.combineActions(actions_1.editQuery, actions_1.editVariables, actions_1.editHeaders, actions_1.editEndpoint, actions_1.setEditorFlex, actions_1.openQueryVariables, actions_1.closeQueryVariables, actions_1.setVariableEditorHeight, actions_1.setResponseTracingHeight, actions_1.setTracingSupported, actions_1.setVariableToType, actions_1.setOperations, actions_1.setOperationName, actions_1.setSubscriptionActive, actions_1.startQuery, actions_1.setQueryTypes, actions_1.editName, actions_1.setResponseExtensions, actions_1.setCurrentQueryStartTime, actions_1.setCurrentQueryEndTime)] = function (state, _a) {\n  var payload = _a.payload;\n  var keys = Object.keys(payload);\n  var keyName = keys.length === 1 ? keys[0] : keys[1];\n  var path = ['sessions', selectors_1.getSelectedSessionId(state), keyName];\n  return state.setIn(path, payload[keyName]);\n}, _a.START_QUERY = function (state) {\n  return state.setIn(['sessions', selectors_1.getSelectedSessionId(state), 'queryRunning'], true).setIn(['sessions', selectors_1.getSelectedSessionId(state), 'responseExtensions'], undefined);\n}, _a.CLOSE_TRACING = function (state, _a) {\n  var responseTracingHeight = _a.payload.responseTracingHeight;\n  return state.mergeDeepIn(['sessions', selectors_1.getSelectedSessionId(state)], immutable_1.Map({\n    responseTracingHeight: responseTracingHeight,\n    responseTracingOpen: false\n  }));\n}, _a.TOGGLE_TRACING = function (state) {\n  var path = ['sessions', selectors_1.getSelectedSessionId(state), 'responseTracingOpen'];\n  return state.setIn(path, !state.getIn(path));\n}, _a.OPEN_TRACING = function (state, _a) {\n  var responseTracingHeight = _a.payload.responseTracingHeight;\n  return state.mergeDeepIn(['sessions', selectors_1.getSelectedSessionId(state)], immutable_1.Map({\n    responseTracingHeight: responseTracingHeight,\n    responseTracingOpen: true\n  }));\n}, _a.CLOSE_VARIABLES = function (state, _a) {\n  var variableEditorHeight = _a.payload.variableEditorHeight;\n  return state.mergeDeepIn(['sessions', selectors_1.getSelectedSessionId(state)], immutable_1.Map({\n    variableEditorHeight: variableEditorHeight,\n    variableEditorOpen: false\n  }));\n}, _a.OPEN_VARIABLES = function (state, _a) {\n  var variableEditorHeight = _a.payload.variableEditorHeight;\n  return state.mergeDeepIn(['sessions', selectors_1.getSelectedSessionId(state)], immutable_1.Map({\n    variableEditorHeight: variableEditorHeight,\n    variableEditorOpen: true\n  }));\n}, _a.TOGGLE_VARIABLES = function (state) {\n  var path = ['sessions', selectors_1.getSelectedSessionId(state), 'variableEditorOpen'];\n  return state.setIn(path, !state.getIn(path));\n}, _a.ADD_RESPONSE = function (state, _a) {\n  var _b = _a.payload,\n      response = _b.response,\n      sessionId = _b.sessionId;\n  return state.updateIn(['sessions', sessionId, 'responses'], function (responses) {\n    return responses.push(response);\n  });\n}, _a.SET_RESPONSE = function (state, _a) {\n  var _b = _a.payload,\n      response = _b.response,\n      sessionId = _b.sessionId;\n  return state.setIn(['sessions', sessionId, 'responses'], immutable_1.List([response]));\n}, _a.CLEAR_RESPONSES = function (state) {\n  return state.setIn(['sessions', selectors_1.getSelectedSessionId(state), 'responses'], immutable_1.List());\n}, _a.FETCH_SCHEMA = function (state) {\n  return state.setIn(['sessions', selectors_1.getSelectedSessionId(state), 'isReloadingSchema'], true);\n}, _a.REFETCH_SCHEMA = function (state) {\n  return state.setIn(['sessions', selectors_1.getSelectedSessionId(state), 'isReloadingSchema'], true);\n}, _a.STOP_QUERY = function (state, _a) {\n  var sessionId = _a.payload.sessionId;\n  return state.mergeIn(['sessions', sessionId], {\n    queryRunning: false,\n    subscriptionActive: false\n  });\n}, _a.SET_SCROLL_TOP = function (state, _a) {\n  var _b = _a.payload,\n      sessionId = _b.sessionId,\n      scrollTop = _b.scrollTop;\n\n  if (state.sessions.get(sessionId)) {\n    return state.setIn(['sessions', sessionId, 'scrollTop'], scrollTop);\n  }\n\n  return state;\n}, _a.SCHEMA_FETCHING_SUCCESS = function (state, _a) {\n  var payload = _a.payload;\n  var newSessions = state.get('sessions').map(function (session) {\n    if (session.endpoint === payload.endpoint) {\n      // if there was an error, clear it away\n      var data = {\n        tracingSupported: payload.tracingSupported,\n        isReloadingSchema: false,\n        endpointUnreachable: false\n      };\n      var response = session.responses ? session.responses.first() : null;\n\n      if (response && session.responses.size === 1 && // @ts-ignore\n      response.isSchemaError) {\n        data.responses = immutable_1.List([]);\n      }\n\n      return session.merge(immutable_1.Map(data));\n    }\n\n    return session;\n  });\n  return state.set('sessions', newSessions);\n}, _a.SET_ENDPOINT_UNREACHABLE = function (state, _a) {\n  var payload = _a.payload;\n  var newSessions = state.get('sessions').map(function (session, sessionId) {\n    if (session.get('endpoint') === payload.endpoint) {\n      return session.merge(immutable_1.Map({\n        endpointUnreachable: true\n      }));\n    }\n\n    return session;\n  });\n  return state.set('sessions', newSessions);\n}, _a.SCHEMA_FETCHING_ERROR = function (state, _a) {\n  var payload = _a.payload;\n  var newSessions = state.get('sessions').map(function (session, sessionId) {\n    if (session.get('endpoint') === payload.endpoint) {\n      var responses = session.responses; // Only override the responses if there is one or zero and that one is a schemaError\n      // Don't override user's responses!\n\n      if (responses.size <= 1) {\n        var response = session.responses ? session.responses.first() : null;\n\n        if (!response || response.isSchemaError) {\n          response = new ResponseRecord({\n            resultID: cuid(),\n            isSchemaError: true,\n            date: JSON.stringify(fetchingSagas_1.formatError(payload.error, true), null, 2),\n            time: new Date()\n          });\n        }\n\n        responses = immutable_1.List([response]);\n      }\n\n      return session.merge(immutable_1.Map({\n        isReloadingSchema: false,\n        endpointUnreachable: true,\n        responses: responses\n      }));\n    }\n\n    return session;\n  });\n  return state.set('sessions', newSessions);\n}, _a.SET_SELECTED_SESSION_ID = function (state, _a) {\n  var sessionId = _a.payload.sessionId;\n  return state.set('selectedSessionId', sessionId);\n}, _a.OPEN_SETTINGS_TAB = function (state) {\n  var newState = state;\n  var settingsTab = state.sessions.find(function (value) {\n    return value.get('isSettingsTab', false);\n  });\n\n  if (!settingsTab) {\n    settingsTab = makeSession().merge({\n      isSettingsTab: true,\n      isFile: true,\n      name: 'Settings',\n      changed: false\n    });\n    newState = newState.setIn(['sessions', settingsTab.id], settingsTab);\n  }\n\n  return newState.set('selectedSessionId', settingsTab.id);\n}, _a.OPEN_CONFIG_TAB = function (state) {\n  var newState = state;\n  var configTab = state.sessions.find(function (value) {\n    return value.get('isConfigTab', false);\n  });\n\n  if (!configTab) {\n    configTab = makeSession().merge({\n      isConfigTab: true,\n      isFile: true,\n      name: 'GraphQL Config',\n      changed: false\n    });\n    newState = newState.setIn(['sessions', configTab.id], configTab);\n  }\n\n  return newState.set('selectedSessionId', configTab.id);\n}, _a.NEW_FILE_TAB = function (state, _a) {\n  var _b = _a.payload,\n      fileName = _b.fileName,\n      filePath = _b.filePath,\n      file = _b.file;\n  var newState = state;\n  var fileTab = state.sessions.find(function (value) {\n    return value.get('name', '') === fileName;\n  });\n\n  if (!fileTab) {\n    fileTab = makeSession().merge({\n      isFile: true,\n      name: fileName,\n      changed: false,\n      file: file,\n      filePath: filePath\n    });\n    newState = newState.setIn(['sessions', fileTab.id], fileTab);\n  }\n\n  return newState.set('selectedSessionId', fileTab.id).set('sessionCount', newState.sessions.size);\n}, _a.NEW_SESSION = function (state, _a) {\n  var _b = _a.payload,\n      reuseHeaders = _b.reuseHeaders,\n      endpoint = _b.endpoint;\n  var currentSession = state.sessions.first();\n  var newSession = {\n    query: '',\n    isReloadingSchema: currentSession.isReloadingSchema,\n    endpointUnreachable: currentSession.endpointUnreachable\n  };\n\n  if (currentSession.endpointUnreachable) {\n    newSession.responses = currentSession.responses;\n  }\n\n  var session = makeSession(endpoint || currentSession.endpoint).merge(newSession);\n\n  if (reuseHeaders) {\n    var selectedSessionId = selectors_1.getSelectedSessionId(state);\n    var currentSession_1 = state.sessions.get(selectedSessionId);\n    session = session.set('headers', currentSession_1.headers);\n  } else {\n    session = session.set('headers', state.headers);\n  }\n\n  return state.setIn(['sessions', session.id], session).set('selectedSessionId', session.id).set('sessionCount', state.sessions.size + 1);\n}, // inject headers is used for graphql config\n// it makes sure, that there definitely is a tab open with the correct header\n_a.INJECT_HEADERS = function (state, _a) {\n  var _b = _a.payload,\n      headers = _b.headers,\n      endpoint = _b.endpoint; // if there are no headers to inject, there's nothing to do\n\n  if (!headers || headers === '' || Object.keys(headers).length === 0) {\n    return state;\n  }\n\n  var headersString = typeof headers === 'string' ? headers : JSON.stringify(headers, null, 2);\n  var selectedSessionId = selectors_1.getSelectedSessionId(state);\n  var newState = state.set('headers', headersString);\n  var currentSession = state.sessions.get(selectedSessionId);\n\n  if (currentSession.headers === headersString) {\n    return newState;\n  }\n\n  if (currentSession.query === constants_1.defaultQuery) {\n    return newState.setIn(['sessions', selectedSessionId, 'headers'], headersString);\n  }\n\n  var session = makeSession(endpoint).set('headers', headersString);\n  return newState.setIn(['sessions', session.id], session).set('selectedSessionId', session.id).set('sessionCount', state.sessions.size + 1);\n}, _a.DUPLICATE_SESSION = function (state, _a) {\n  var session = _a.payload.session;\n  var newSession = session.set('id', cuid());\n  return state.setIn(['sessions', newSession.id], newSession).set('selectedSessionId', newSession.id).set('sessionCount', state.sessions.size + 1);\n}, _a.NEW_SESSION_FROM_QUERY = function (state, _a) {\n  var query = _a.payload.query;\n  var session = makeSession().set('query', query);\n  return state.setIn(['sessions', session.id], session).set('sessionCount', state.sessions.size + 1);\n}, _a.CLOSE_SELECTED_TAB = function (state) {\n  var selectedSessionId = selectors_1.getSelectedSessionId(state);\n  return closeTab(state, selectedSessionId).set('sessionCount', state.sessions.size - 1);\n}, _a.SELECT_NEXT_TAB = function (state) {\n  var selectedSessionId = selectors_1.getSelectedSessionId(state);\n  var count = state.sessions.size;\n  var keys = state.sessions.keySeq();\n  var index = keys.indexOf(selectedSessionId);\n\n  if (index + 1 < count) {\n    return state.set('selectedSessionId', keys.get(index + 1));\n  }\n\n  return state.set('selectedSessionId', keys.get(0));\n}, _a.SELECT_PREV_TAB = function (state) {\n  var selectedSessionId = selectors_1.getSelectedSessionId(state);\n  var count = state.sessions.size;\n  var keys = state.sessions.keySeq();\n  var index = keys.indexOf(selectedSessionId);\n\n  if (index - 1 >= 0) {\n    return state.set('selectedSessionId', keys.get(index - 1));\n  }\n\n  return state.set('selectedSessionId', keys.get(count - 1));\n}, _a.SELECT_TAB_INDEX = function (state, _a) {\n  var index = _a.payload.index;\n  var keys = state.sessions.keySeq();\n  return state.set('selectedSessionId', keys.get(index));\n}, _a.SELECT_TAB = function (state, _a) {\n  var sessionId = _a.payload.sessionId;\n  return state.set('selectedSessionId', sessionId);\n}, _a.CLOSE_TAB = function (state, _a) {\n  var sessionId = _a.payload.sessionId;\n  return closeTab(state, sessionId).set('sessionCount', state.sessions.size - 1);\n}, _a.REORDER_TABS = function (state, _a) {\n  var _b = _a.payload,\n      src = _b.src,\n      dest = _b.dest;\n  var seq = state.sessions.toIndexedSeq();\n  var indexes = [];\n\n  for (var i = 0; i < seq.size; i++) {\n    indexes.push(i);\n  }\n\n  var newIndexes = react_sortable_hoc_1.arrayMove(indexes, src, dest);\n  var newSessions = immutable_1.OrderedMap();\n\n  for (var i = 0; i < seq.size; i++) {\n    var ndx = newIndexes[i];\n    var val = seq.get(ndx);\n    newSessions = newSessions.set(val.id, val);\n  }\n\n  return state.set('sessions', newSessions);\n}, _a.EDIT_SETTINGS = function (state) {\n  return state.setIn(['sessions', selectors_1.getSelectedSessionId(state), 'changed'], true);\n}, _a.SAVE_SETTINGS = function (state) {\n  return state.setIn(['sessions', selectors_1.getSelectedSessionId(state), 'changed'], false);\n}, _a.EDIT_CONFIG = function (state) {\n  return state.setIn(['sessions', selectors_1.getSelectedSessionId(state), 'changed'], true);\n}, _a.SAVE_CONFIG = function (state) {\n  return state.setIn(['sessions', selectors_1.getSelectedSessionId(state), 'changed'], false);\n}, _a.EDIT_FILE = function (state) {\n  return state.setIn(['sessions', selectors_1.getSelectedSessionId(state), 'changed'], true);\n}, _a.SAVE_FILE = function (state) {\n  return state.setIn(['sessions', selectors_1.getSelectedSessionId(state), 'changed'], false);\n}, _a), makeSessionState('')); // add a self-healing wrapper to clean up broken states\n\nexports[\"default\"] = function (state, action) {\n  var newState = reducer(state, action);\n\n  if (newState.selectedSessionId === '' && state.sessions.size > 0) {\n    return newState.set('selectedSessionId', state.sessions.first().id);\n  }\n\n  return newState;\n};\n\nfunction closeTab(state, sessionId) {\n  var length = state.sessions.size;\n  var keys = state.sessions.keySeq();\n  var newState = state.removeIn(['sessions', sessionId]);\n  var session = state.sessions.get(sessionId); // if there is only one session, delete it and replace it by a new one\n  // and keep the endpoint & headers of the last one\n\n  if (length === 1) {\n    var newSessionData = {\n      query: '',\n      headers: session.headers,\n      isReloadingSchema: session.isReloadingSchema,\n      endpointUnreachable: session.endpointUnreachable\n    };\n\n    if (session.endpointUnreachable) {\n      newSessionData.responses = session.responses;\n    }\n\n    var newSession = makeSession(session.endpoint).merge(newSessionData);\n    newState = newState.set('selectedSessionId', newSession.id);\n    return newState.setIn(['sessions', newSession.id], newSession);\n  }\n\n  var selectedSessionId = selectors_1.getSelectedSessionId(state);\n  var sessionIndex = keys.indexOf(sessionId); // if the session to be closed is selected, unselect it\n\n  if (selectedSessionId === sessionId) {\n    var leftNeighbour = sessionIndex - 1; // if its the first session on the left, take the right neighbour\n\n    if (leftNeighbour < 0) {\n      return newState.set('selectedSessionId', keys.get(1));\n    }\n\n    return newState.set('selectedSessionId', keys.get(leftNeighbour));\n  } else {\n    // otherwise the old selected session still can be selected, only the session has to be removed\n    return newState;\n  }\n}"]},"metadata":{},"sourceType":"script"}