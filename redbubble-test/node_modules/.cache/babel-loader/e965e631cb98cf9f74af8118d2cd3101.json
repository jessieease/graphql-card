{"ast":null,"code":"\"use strict\";\n\nfunction _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") {\n    _typeof = function _typeof(obj) {\n      return typeof obj;\n    };\n  } else {\n    _typeof = function _typeof(obj) {\n      return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n    };\n  }\n\n  return _typeof(obj);\n}\n\nvar __assign = void 0 && (void 0).__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) {\n        if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __generator = void 0 && (void 0).__generator || function (thisArg, body) {\n  var _ = {\n    label: 0,\n    sent: function sent() {\n      if (t[0] & 1) throw t[1];\n      return t[1];\n    },\n    trys: [],\n    ops: []\n  },\n      f,\n      y,\n      t,\n      g;\n  return g = {\n    next: verb(0),\n    \"throw\": verb(1),\n    \"return\": verb(2)\n  }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n\n    while (_) {\n      try {\n        if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n        if (y = 0, t) op = [op[0] & 2, t.value];\n\n        switch (op[0]) {\n          case 0:\n          case 1:\n            t = op;\n            break;\n\n          case 4:\n            _.label++;\n            return {\n              value: op[1],\n              done: false\n            };\n\n          case 5:\n            _.label++;\n            y = op[1];\n            op = [0];\n            continue;\n\n          case 7:\n            op = _.ops.pop();\n\n            _.trys.pop();\n\n            continue;\n\n          default:\n            if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n              _ = 0;\n              continue;\n            }\n\n            if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n              _.label = op[1];\n              break;\n            }\n\n            if (op[0] === 6 && _.label < t[1]) {\n              _.label = t[1];\n              t = op;\n              break;\n            }\n\n            if (t && _.label < t[2]) {\n              _.label = t[2];\n\n              _.ops.push(op);\n\n              break;\n            }\n\n            if (t[2]) _.ops.pop();\n\n            _.trys.pop();\n\n            continue;\n        }\n\n        op = body.call(thisArg, _);\n      } catch (e) {\n        op = [6, e];\n        y = 0;\n      } finally {\n        f = t = 0;\n      }\n    }\n\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar apollo_link_1 = require(\"apollo-link\");\n\nvar parseHeaders_1 = require(\"../../components/Playground/util/parseHeaders\");\n\nvar subscriptions_transport_ws_1 = require(\"subscriptions-transport-ws\");\n\nvar apollo_link_http_1 = require(\"apollo-link-http\");\n\nvar apollo_link_ws_1 = require(\"apollo-link-ws\");\n\nvar hasSubscription_1 = require(\"../../components/Playground/util/hasSubscription\");\n\nvar effects_1 = require(\"redux-saga/effects\");\n\nvar redux_saga_1 = require(\"redux-saga\");\n\nvar makeOperation_1 = require(\"../../components/Playground/util/makeOperation\");\n\nvar actions_1 = require(\"./actions\");\n\nvar selectors_1 = require(\"./selectors\");\n\nvar SchemaFetcher_1 = require(\"../../components/Playground/SchemaFetcher\");\n\nvar reducers_1 = require(\"../workspace/reducers\");\n\nvar cuid = require(\"cuid\");\n\nvar reducers_2 = require(\"./reducers\");\n\nvar actions_2 = require(\"../history/actions\");\n\nvar utils_1 = require(\"../../utils\");\n\nvar immutable_1 = require(\"immutable\"); // tslint:disable\n\n\nvar subscriptionEndpoint;\n\nfunction setSubscriptionEndpoint(endpoint) {\n  subscriptionEndpoint = endpoint;\n}\n\nexports.setSubscriptionEndpoint = setSubscriptionEndpoint;\n\nexports.defaultLinkCreator = function (session, subscriptionEndpoint) {\n  var connectionParams = {};\n  var headers = session.headers,\n      credentials = session.credentials;\n\n  if (headers) {\n    connectionParams = __assign({}, headers);\n  }\n\n  var httpLink = new apollo_link_http_1.HttpLink({\n    uri: session.endpoint,\n    headers: headers,\n    credentials: credentials\n  });\n\n  if (!subscriptionEndpoint) {\n    return {\n      link: httpLink\n    };\n  }\n\n  var subscriptionClient = new subscriptions_transport_ws_1.SubscriptionClient(subscriptionEndpoint, {\n    timeout: 20000,\n    lazy: true,\n    connectionParams: connectionParams\n  });\n  var webSocketLink = new apollo_link_ws_1.WebSocketLink(subscriptionClient);\n  return {\n    link: apollo_link_1.ApolloLink.split(function (operation) {\n      return hasSubscription_1.isSubscription(operation);\n    }, webSocketLink, httpLink),\n    subscriptionClient: subscriptionClient\n  };\n};\n\nvar linkCreator = exports.defaultLinkCreator;\nexports.schemaFetcher = new SchemaFetcher_1.SchemaFetcher(linkCreator);\nwindow.schemaFetcher = exports.schemaFetcher;\n\nfunction setLinkCreator(newLinkCreator) {\n  if (newLinkCreator) {\n    linkCreator = newLinkCreator;\n    exports.schemaFetcher = new SchemaFetcher_1.SchemaFetcher(newLinkCreator);\n  }\n}\n\nexports.setLinkCreator = setLinkCreator;\nvar subscriptions = {};\n\nfunction runQuerySaga(action) {\n  var operationName, selectedWorkspaceId, session, request, operation, operationIsSubscription, workspace, settings, headers, lol, _a, link, subscriptionClient, firstResponse, channel, _b, value, error, extensions, response, errorMessage;\n\n  return __generator(this, function (_c) {\n    switch (_c.label) {\n      case 0:\n        operationName = action.payload.operationName;\n        return [4\n        /*yield*/\n        , effects_1.select(reducers_1.getSelectedWorkspaceId)];\n\n      case 1:\n        selectedWorkspaceId = _c.sent();\n        return [4\n        /*yield*/\n        , effects_1.select(selectors_1.getSelectedSession)];\n\n      case 2:\n        session = _c.sent();\n        request = {\n          query: session.query,\n          operationName: operationName,\n          variables: selectors_1.getParsedVariablesFromSession(session)\n        };\n        operation = makeOperation_1.makeOperation(request);\n        operationIsSubscription = hasSubscription_1.isSubscription(operation);\n        return [4\n        /*yield*/\n        , effects_1.select(reducers_1.getSelectedWorkspaceId)];\n\n      case 3:\n        workspace = _c.sent();\n        return [4\n        /*yield*/\n        , effects_1.select(reducers_1.getSettings)];\n\n      case 4:\n        settings = _c.sent();\n        return [4\n        /*yield*/\n        , effects_1.put(actions_1.setSubscriptionActive(hasSubscription_1.isSubscription(operation)))];\n\n      case 5:\n        _c.sent();\n\n        return [4\n        /*yield*/\n        , effects_1.put(actions_1.startQuery())];\n\n      case 6:\n        _c.sent();\n\n        headers = parseHeaders_1.parseHeaders(session.headers);\n\n        if (session.tracingSupported && session.responseTracingOpen) {\n          headers = immutable_1.set(headers, 'X-Apollo-Tracing', '1');\n        }\n\n        lol = {\n          endpoint: session.endpoint,\n          headers: __assign(__assign({}, settings['request.globalHeaders']), headers),\n          credentials: settings['request.credentials']\n        };\n        _a = linkCreator(lol, subscriptionEndpoint), link = _a.link, subscriptionClient = _a.subscriptionClient;\n        return [4\n        /*yield*/\n        , effects_1.put(actions_1.setCurrentQueryStartTime(new Date()))];\n\n      case 7:\n        _c.sent();\n\n        firstResponse = false;\n        channel = redux_saga_1.eventChannel(function (emitter) {\n          var closed = false;\n\n          if (subscriptionClient && operationIsSubscription) {\n            subscriptionClient.onDisconnected(function () {\n              closed = true;\n              emitter({\n                error: new Error(\"Could not connect to websocket endpoint \" + subscriptionEndpoint + \". Please check if the endpoint url is correct.\")\n              });\n              emitter(redux_saga_1.END);\n            });\n          }\n\n          var subscription = apollo_link_1.execute(link, operation).subscribe({\n            next: function next(value) {\n              emitter({\n                value: value\n              });\n            },\n            error: function error(_error) {\n              emitter({\n                error: _error\n              });\n              emitter(redux_saga_1.END);\n            },\n            complete: function complete() {\n              emitter(redux_saga_1.END);\n            }\n          });\n\n          var unsubscribe = function unsubscribe() {\n            if (!closed) {\n              try {\n                subscription.unsubscribe();\n              } catch (e) {\n                console.error(e);\n              }\n            }\n          };\n\n          var key = workspace + \"~\" + session.id;\n          subscriptions[key] = {\n            unsubscribe: unsubscribe\n          };\n          return unsubscribe;\n        });\n        _c.label = 8;\n\n      case 8:\n        _c.trys.push([8,, 23, 26]);\n\n        _c.label = 9;\n\n      case 9:\n        if (!true) return [3\n        /*break*/\n        , 22];\n        return [4\n        /*yield*/\n        , effects_1.take(channel)];\n\n      case 10:\n        _b = _c.sent(), value = _b.value, error = _b.error;\n        if (!(value && value.extensions)) return [3\n        /*break*/\n        , 12];\n        extensions = value.extensions;\n        return [4\n        /*yield*/\n        , effects_1.put(actions_1.setResponseExtensions(extensions))];\n\n      case 11:\n        _c.sent();\n\n        if (value.extensions.tracing && settings['tracing.hideTracingResponse']) {\n          delete value.extensions.tracing;\n        }\n\n        _c.label = 12;\n\n      case 12:\n        response = new reducers_2.ResponseRecord({\n          date: JSON.stringify(value ? value : formatError(error), null, 2),\n          time: new Date(),\n          resultID: cuid()\n        });\n        errorMessage = extractMessage(error);\n        if (!(errorMessage === 'Failed to fetch')) return [3\n        /*break*/\n        , 14];\n        return [4\n        /*yield*/\n        , effects_1.put(actions_1.setEndpointUnreachable(session.endpoint))];\n\n      case 13:\n        _c.sent();\n\n        _c.label = 14;\n\n      case 14:\n        if (!operationIsSubscription) return [3\n        /*break*/\n        , 18];\n        if (!firstResponse) return [3\n        /*break*/\n        , 16];\n        return [4\n        /*yield*/\n        , effects_1.put(actions_1.clearResponses())];\n\n      case 15:\n        _c.sent();\n\n        firstResponse = false;\n        _c.label = 16;\n\n      case 16:\n        return [4\n        /*yield*/\n        , effects_1.put(actions_1.addResponse(selectedWorkspaceId, session.id, response))];\n\n      case 17:\n        _c.sent();\n\n        return [3\n        /*break*/\n        , 20];\n\n      case 18:\n        return [4\n        /*yield*/\n        , effects_1.put(actions_1.setResponse(selectedWorkspaceId, session.id, response))];\n\n      case 19:\n        _c.sent();\n\n        _c.label = 20;\n\n      case 20:\n        return [4\n        /*yield*/\n        , effects_1.put(actions_2.addHistoryItem(session))];\n\n      case 21:\n        _c.sent();\n\n        return [3\n        /*break*/\n        , 9];\n\n      case 22:\n        return [3\n        /*break*/\n        , 26];\n\n      case 23:\n        return [4\n        /*yield*/\n        , effects_1.put(actions_1.setCurrentQueryEndTime(new Date()))];\n\n      case 24:\n        _c.sent();\n\n        return [4\n        /*yield*/\n        , effects_1.put(actions_1.stopQuery(session.id, selectedWorkspaceId))];\n\n      case 25:\n        _c.sent();\n\n        return [7\n        /*endfinally*/\n        ];\n\n      case 26:\n        return [2\n        /*return*/\n        ];\n    }\n  });\n}\n\nfunction formatError(error, fetchingSchema) {\n  if (fetchingSchema === void 0) {\n    fetchingSchema = false;\n  }\n\n  var message = extractMessage(error);\n\n  if (message === 'Failed to fetch') {\n    var schemaMessage = fetchingSchema ? ' schema' : '';\n    return {\n      error: \"\" + message + schemaMessage + \". Please check your connection\"\n    };\n  }\n\n  try {\n    var ee = JSON.parse(message);\n    return ee;\n  } catch (e) {//\n  }\n\n  return {\n    error: message\n  };\n}\n\nexports.formatError = formatError;\n\nfunction extractMessage(error) {\n  if (error instanceof Error) {\n    // Errors from apollo-link-http may include a \"result\" object, which is a JSON response from\n    // the server. We should surface that to the client\n    if (!!error['result'] && _typeof(error['result']) === 'object') {\n      return error.result;\n    }\n\n    return error.message;\n  }\n\n  if (typeof error === 'string') {\n    return error;\n  }\n\n  return error;\n}\n\nfunction stopQuerySaga(action) {\n  var _a, sessionId, workspaceId, sessions, session, workspace, key, subscription;\n\n  return __generator(this, function (_b) {\n    switch (_b.label) {\n      case 0:\n        _a = action.payload, sessionId = _a.sessionId, workspaceId = _a.workspaceId;\n        return [4\n        /*yield*/\n        , effects_1.select(selectors_1.getSessionsState)];\n\n      case 1:\n        sessions = _b.sent().sessions;\n        session = sessions.get(sessionId);\n        return [4\n        /*yield*/\n        , workspaceId || effects_1.select(reducers_1.getSelectedWorkspaceId)];\n\n      case 2:\n        workspace = _b.sent();\n        key = workspace + \"~\" + session.id;\n        subscription = subscriptions[key];\n\n        if (subscription && subscription.unsubscribe) {\n          subscription.unsubscribe();\n        }\n\n        delete subscriptions[key];\n        return [2\n        /*return*/\n        ];\n    }\n  });\n}\n\nexports.fecthingSagas = [effects_1.takeEvery('RUN_QUERY', utils_1.safely(runQuerySaga)), effects_1.takeLatest('STOP_QUERY', utils_1.safely(stopQuerySaga))];","map":{"version":3,"sources":["/Users/wubo/Desktop/card-design/card-design/node_modules/graphql-playground-react/lib/state/sessions/fetchingSagas.js"],"names":["_typeof","obj","Symbol","iterator","constructor","prototype","__assign","Object","assign","t","s","i","n","arguments","length","p","hasOwnProperty","call","apply","__generator","thisArg","body","_","label","sent","trys","ops","f","y","g","next","verb","v","step","op","TypeError","done","value","pop","push","e","defineProperty","exports","apollo_link_1","require","parseHeaders_1","subscriptions_transport_ws_1","apollo_link_http_1","apollo_link_ws_1","hasSubscription_1","effects_1","redux_saga_1","makeOperation_1","actions_1","selectors_1","SchemaFetcher_1","reducers_1","cuid","reducers_2","actions_2","utils_1","immutable_1","subscriptionEndpoint","setSubscriptionEndpoint","endpoint","defaultLinkCreator","session","connectionParams","headers","credentials","httpLink","HttpLink","uri","link","subscriptionClient","SubscriptionClient","timeout","lazy","webSocketLink","WebSocketLink","ApolloLink","split","operation","isSubscription","linkCreator","schemaFetcher","SchemaFetcher","window","setLinkCreator","newLinkCreator","subscriptions","runQuerySaga","action","operationName","selectedWorkspaceId","request","operationIsSubscription","workspace","settings","lol","_a","firstResponse","channel","_b","error","extensions","response","errorMessage","_c","payload","select","getSelectedWorkspaceId","getSelectedSession","query","variables","getParsedVariablesFromSession","makeOperation","getSettings","put","setSubscriptionActive","startQuery","parseHeaders","tracingSupported","responseTracingOpen","set","setCurrentQueryStartTime","Date","eventChannel","emitter","closed","onDisconnected","Error","END","subscription","execute","subscribe","_error","complete","unsubscribe","console","key","id","take","setResponseExtensions","tracing","ResponseRecord","date","JSON","stringify","formatError","time","resultID","extractMessage","setEndpointUnreachable","clearResponses","addResponse","setResponse","addHistoryItem","setCurrentQueryEndTime","stopQuery","fetchingSchema","message","schemaMessage","ee","parse","result","stopQuerySaga","sessionId","workspaceId","sessions","getSessionsState","get","fecthingSagas","takeEvery","safely","takeLatest"],"mappings":"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","sourcesContent":["\"use strict\";\n\nfunction _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\nvar __assign = void 0 && (void 0).__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) {\n        if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __generator = void 0 && (void 0).__generator || function (thisArg, body) {\n  var _ = {\n    label: 0,\n    sent: function sent() {\n      if (t[0] & 1) throw t[1];\n      return t[1];\n    },\n    trys: [],\n    ops: []\n  },\n      f,\n      y,\n      t,\n      g;\n  return g = {\n    next: verb(0),\n    \"throw\": verb(1),\n    \"return\": verb(2)\n  }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n\n    while (_) {\n      try {\n        if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n        if (y = 0, t) op = [op[0] & 2, t.value];\n\n        switch (op[0]) {\n          case 0:\n          case 1:\n            t = op;\n            break;\n\n          case 4:\n            _.label++;\n            return {\n              value: op[1],\n              done: false\n            };\n\n          case 5:\n            _.label++;\n            y = op[1];\n            op = [0];\n            continue;\n\n          case 7:\n            op = _.ops.pop();\n\n            _.trys.pop();\n\n            continue;\n\n          default:\n            if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n              _ = 0;\n              continue;\n            }\n\n            if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n              _.label = op[1];\n              break;\n            }\n\n            if (op[0] === 6 && _.label < t[1]) {\n              _.label = t[1];\n              t = op;\n              break;\n            }\n\n            if (t && _.label < t[2]) {\n              _.label = t[2];\n\n              _.ops.push(op);\n\n              break;\n            }\n\n            if (t[2]) _.ops.pop();\n\n            _.trys.pop();\n\n            continue;\n        }\n\n        op = body.call(thisArg, _);\n      } catch (e) {\n        op = [6, e];\n        y = 0;\n      } finally {\n        f = t = 0;\n      }\n    }\n\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar apollo_link_1 = require(\"apollo-link\");\n\nvar parseHeaders_1 = require(\"../../components/Playground/util/parseHeaders\");\n\nvar subscriptions_transport_ws_1 = require(\"subscriptions-transport-ws\");\n\nvar apollo_link_http_1 = require(\"apollo-link-http\");\n\nvar apollo_link_ws_1 = require(\"apollo-link-ws\");\n\nvar hasSubscription_1 = require(\"../../components/Playground/util/hasSubscription\");\n\nvar effects_1 = require(\"redux-saga/effects\");\n\nvar redux_saga_1 = require(\"redux-saga\");\n\nvar makeOperation_1 = require(\"../../components/Playground/util/makeOperation\");\n\nvar actions_1 = require(\"./actions\");\n\nvar selectors_1 = require(\"./selectors\");\n\nvar SchemaFetcher_1 = require(\"../../components/Playground/SchemaFetcher\");\n\nvar reducers_1 = require(\"../workspace/reducers\");\n\nvar cuid = require(\"cuid\");\n\nvar reducers_2 = require(\"./reducers\");\n\nvar actions_2 = require(\"../history/actions\");\n\nvar utils_1 = require(\"../../utils\");\n\nvar immutable_1 = require(\"immutable\"); // tslint:disable\n\n\nvar subscriptionEndpoint;\n\nfunction setSubscriptionEndpoint(endpoint) {\n  subscriptionEndpoint = endpoint;\n}\n\nexports.setSubscriptionEndpoint = setSubscriptionEndpoint;\n\nexports.defaultLinkCreator = function (session, subscriptionEndpoint) {\n  var connectionParams = {};\n  var headers = session.headers,\n      credentials = session.credentials;\n\n  if (headers) {\n    connectionParams = __assign({}, headers);\n  }\n\n  var httpLink = new apollo_link_http_1.HttpLink({\n    uri: session.endpoint,\n    headers: headers,\n    credentials: credentials\n  });\n\n  if (!subscriptionEndpoint) {\n    return {\n      link: httpLink\n    };\n  }\n\n  var subscriptionClient = new subscriptions_transport_ws_1.SubscriptionClient(subscriptionEndpoint, {\n    timeout: 20000,\n    lazy: true,\n    connectionParams: connectionParams\n  });\n  var webSocketLink = new apollo_link_ws_1.WebSocketLink(subscriptionClient);\n  return {\n    link: apollo_link_1.ApolloLink.split(function (operation) {\n      return hasSubscription_1.isSubscription(operation);\n    }, webSocketLink, httpLink),\n    subscriptionClient: subscriptionClient\n  };\n};\n\nvar linkCreator = exports.defaultLinkCreator;\nexports.schemaFetcher = new SchemaFetcher_1.SchemaFetcher(linkCreator);\nwindow.schemaFetcher = exports.schemaFetcher;\n\nfunction setLinkCreator(newLinkCreator) {\n  if (newLinkCreator) {\n    linkCreator = newLinkCreator;\n    exports.schemaFetcher = new SchemaFetcher_1.SchemaFetcher(newLinkCreator);\n  }\n}\n\nexports.setLinkCreator = setLinkCreator;\nvar subscriptions = {};\n\nfunction runQuerySaga(action) {\n  var operationName, selectedWorkspaceId, session, request, operation, operationIsSubscription, workspace, settings, headers, lol, _a, link, subscriptionClient, firstResponse, channel, _b, value, error, extensions, response, errorMessage;\n\n  return __generator(this, function (_c) {\n    switch (_c.label) {\n      case 0:\n        operationName = action.payload.operationName;\n        return [4\n        /*yield*/\n        , effects_1.select(reducers_1.getSelectedWorkspaceId)];\n\n      case 1:\n        selectedWorkspaceId = _c.sent();\n        return [4\n        /*yield*/\n        , effects_1.select(selectors_1.getSelectedSession)];\n\n      case 2:\n        session = _c.sent();\n        request = {\n          query: session.query,\n          operationName: operationName,\n          variables: selectors_1.getParsedVariablesFromSession(session)\n        };\n        operation = makeOperation_1.makeOperation(request);\n        operationIsSubscription = hasSubscription_1.isSubscription(operation);\n        return [4\n        /*yield*/\n        , effects_1.select(reducers_1.getSelectedWorkspaceId)];\n\n      case 3:\n        workspace = _c.sent();\n        return [4\n        /*yield*/\n        , effects_1.select(reducers_1.getSettings)];\n\n      case 4:\n        settings = _c.sent();\n        return [4\n        /*yield*/\n        , effects_1.put(actions_1.setSubscriptionActive(hasSubscription_1.isSubscription(operation)))];\n\n      case 5:\n        _c.sent();\n\n        return [4\n        /*yield*/\n        , effects_1.put(actions_1.startQuery())];\n\n      case 6:\n        _c.sent();\n\n        headers = parseHeaders_1.parseHeaders(session.headers);\n\n        if (session.tracingSupported && session.responseTracingOpen) {\n          headers = immutable_1.set(headers, 'X-Apollo-Tracing', '1');\n        }\n\n        lol = {\n          endpoint: session.endpoint,\n          headers: __assign(__assign({}, settings['request.globalHeaders']), headers),\n          credentials: settings['request.credentials']\n        };\n        _a = linkCreator(lol, subscriptionEndpoint), link = _a.link, subscriptionClient = _a.subscriptionClient;\n        return [4\n        /*yield*/\n        , effects_1.put(actions_1.setCurrentQueryStartTime(new Date()))];\n\n      case 7:\n        _c.sent();\n\n        firstResponse = false;\n        channel = redux_saga_1.eventChannel(function (emitter) {\n          var closed = false;\n\n          if (subscriptionClient && operationIsSubscription) {\n            subscriptionClient.onDisconnected(function () {\n              closed = true;\n              emitter({\n                error: new Error(\"Could not connect to websocket endpoint \" + subscriptionEndpoint + \". Please check if the endpoint url is correct.\")\n              });\n              emitter(redux_saga_1.END);\n            });\n          }\n\n          var subscription = apollo_link_1.execute(link, operation).subscribe({\n            next: function next(value) {\n              emitter({\n                value: value\n              });\n            },\n            error: function error(_error) {\n              emitter({\n                error: _error\n              });\n              emitter(redux_saga_1.END);\n            },\n            complete: function complete() {\n              emitter(redux_saga_1.END);\n            }\n          });\n\n          var unsubscribe = function unsubscribe() {\n            if (!closed) {\n              try {\n                subscription.unsubscribe();\n              } catch (e) {\n                console.error(e);\n              }\n            }\n          };\n\n          var key = workspace + \"~\" + session.id;\n          subscriptions[key] = {\n            unsubscribe: unsubscribe\n          };\n          return unsubscribe;\n        });\n        _c.label = 8;\n\n      case 8:\n        _c.trys.push([8,, 23, 26]);\n\n        _c.label = 9;\n\n      case 9:\n        if (!true) return [3\n        /*break*/\n        , 22];\n        return [4\n        /*yield*/\n        , effects_1.take(channel)];\n\n      case 10:\n        _b = _c.sent(), value = _b.value, error = _b.error;\n        if (!(value && value.extensions)) return [3\n        /*break*/\n        , 12];\n        extensions = value.extensions;\n        return [4\n        /*yield*/\n        , effects_1.put(actions_1.setResponseExtensions(extensions))];\n\n      case 11:\n        _c.sent();\n\n        if (value.extensions.tracing && settings['tracing.hideTracingResponse']) {\n          delete value.extensions.tracing;\n        }\n\n        _c.label = 12;\n\n      case 12:\n        response = new reducers_2.ResponseRecord({\n          date: JSON.stringify(value ? value : formatError(error), null, 2),\n          time: new Date(),\n          resultID: cuid()\n        });\n        errorMessage = extractMessage(error);\n        if (!(errorMessage === 'Failed to fetch')) return [3\n        /*break*/\n        , 14];\n        return [4\n        /*yield*/\n        , effects_1.put(actions_1.setEndpointUnreachable(session.endpoint))];\n\n      case 13:\n        _c.sent();\n\n        _c.label = 14;\n\n      case 14:\n        if (!operationIsSubscription) return [3\n        /*break*/\n        , 18];\n        if (!firstResponse) return [3\n        /*break*/\n        , 16];\n        return [4\n        /*yield*/\n        , effects_1.put(actions_1.clearResponses())];\n\n      case 15:\n        _c.sent();\n\n        firstResponse = false;\n        _c.label = 16;\n\n      case 16:\n        return [4\n        /*yield*/\n        , effects_1.put(actions_1.addResponse(selectedWorkspaceId, session.id, response))];\n\n      case 17:\n        _c.sent();\n\n        return [3\n        /*break*/\n        , 20];\n\n      case 18:\n        return [4\n        /*yield*/\n        , effects_1.put(actions_1.setResponse(selectedWorkspaceId, session.id, response))];\n\n      case 19:\n        _c.sent();\n\n        _c.label = 20;\n\n      case 20:\n        return [4\n        /*yield*/\n        , effects_1.put(actions_2.addHistoryItem(session))];\n\n      case 21:\n        _c.sent();\n\n        return [3\n        /*break*/\n        , 9];\n\n      case 22:\n        return [3\n        /*break*/\n        , 26];\n\n      case 23:\n        return [4\n        /*yield*/\n        , effects_1.put(actions_1.setCurrentQueryEndTime(new Date()))];\n\n      case 24:\n        _c.sent();\n\n        return [4\n        /*yield*/\n        , effects_1.put(actions_1.stopQuery(session.id, selectedWorkspaceId))];\n\n      case 25:\n        _c.sent();\n\n        return [7\n        /*endfinally*/\n        ];\n\n      case 26:\n        return [2\n        /*return*/\n        ];\n    }\n  });\n}\n\nfunction formatError(error, fetchingSchema) {\n  if (fetchingSchema === void 0) {\n    fetchingSchema = false;\n  }\n\n  var message = extractMessage(error);\n\n  if (message === 'Failed to fetch') {\n    var schemaMessage = fetchingSchema ? ' schema' : '';\n    return {\n      error: \"\" + message + schemaMessage + \". Please check your connection\"\n    };\n  }\n\n  try {\n    var ee = JSON.parse(message);\n    return ee;\n  } catch (e) {//\n  }\n\n  return {\n    error: message\n  };\n}\n\nexports.formatError = formatError;\n\nfunction extractMessage(error) {\n  if (error instanceof Error) {\n    // Errors from apollo-link-http may include a \"result\" object, which is a JSON response from\n    // the server. We should surface that to the client\n    if (!!error['result'] && _typeof(error['result']) === 'object') {\n      return error.result;\n    }\n\n    return error.message;\n  }\n\n  if (typeof error === 'string') {\n    return error;\n  }\n\n  return error;\n}\n\nfunction stopQuerySaga(action) {\n  var _a, sessionId, workspaceId, sessions, session, workspace, key, subscription;\n\n  return __generator(this, function (_b) {\n    switch (_b.label) {\n      case 0:\n        _a = action.payload, sessionId = _a.sessionId, workspaceId = _a.workspaceId;\n        return [4\n        /*yield*/\n        , effects_1.select(selectors_1.getSessionsState)];\n\n      case 1:\n        sessions = _b.sent().sessions;\n        session = sessions.get(sessionId);\n        return [4\n        /*yield*/\n        , workspaceId || effects_1.select(reducers_1.getSelectedWorkspaceId)];\n\n      case 2:\n        workspace = _b.sent();\n        key = workspace + \"~\" + session.id;\n        subscription = subscriptions[key];\n\n        if (subscription && subscription.unsubscribe) {\n          subscription.unsubscribe();\n        }\n\n        delete subscriptions[key];\n        return [2\n        /*return*/\n        ];\n    }\n  });\n}\n\nexports.fecthingSagas = [effects_1.takeEvery('RUN_QUERY', utils_1.safely(runQuerySaga)), effects_1.takeLatest('STOP_QUERY', utils_1.safely(stopQuerySaga))];"]},"metadata":{},"sourceType":"script"}